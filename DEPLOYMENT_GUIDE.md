# ðŸš€ Deployment Guide - MMU Bicycle Rental System

## OPTION 1: Deploy to Render (Recommended - FREE)

### Prerequisites
- GitHub account
- Render account (free at render.com)

### Step 1: Prepare Repository

```bash
# Initialize git if not already done
git init

# Add all files
git add .

# Commit
git commit -m "Initial commit - MMU Bicycle Rental System"

# Create GitHub repository (via web interface)
# Then push
git remote add origin https://github.com/YOUR_USERNAME/mmu-bicycle-rental.git
git branch -M main
git push -u origin main
```

### Step 2: Make build.sh Executable

```bash
chmod +x build.sh
git add build.sh
git commit -m "Make build script executable"
git push
```

### Step 3: Deploy on Render

1. **Go to [render.com](https://render.com)** and sign up/login
2. **Click "New +"** â†’ Select "Web Service"
3. **Connect your GitHub repository**
4. **Configure the service:**
   - **Name:** `mmu-bicycle-rental`
   - **Environment:** `Python 3`
   - **Build Command:** `./build.sh`
   - **Start Command:** `gunicorn config.wsgi:application`
   - **Plan:** Select `Free`

5. **Add Environment Variables:**
   ```
   PYTHON_VERSION=3.11.0
   DJANGO_SETTINGS_MODULE=config.settings.production
   SECRET_KEY=[Auto-generated by Render]
   DEBUG=False
   ```

6. **Create PostgreSQL Database:**
   - Go to Dashboard â†’ Click "New +"
   - Select "PostgreSQL"
   - Name: `mmu-bicycle-db`
   - Plan: Free
   - Click "Create Database"

7. **Connect Database to Web Service:**
   - Go to your web service
   - Go to "Environment" tab
   - Add environment variable:
     - Key: `DATABASE_URL`
     - Value: [Copy from your PostgreSQL database "Internal Database URL"]

8. **Deploy:**
   - Click "Create Web Service"
   - Wait 5-10 minutes for deployment
   - Your app will be live at: `https://mmu-bicycle-rental.onrender.com`

### Step 4: Create Superuser (After Deployment)

```bash
# Using Render Shell
1. Go to your web service dashboard
2. Click "Shell" tab
3. Run: python manage.py createsuperuser
4. Follow prompts to create admin user
```

### Step 5: Load Test Data (Optional)

```bash
# In Render Shell
python manage.py shell < create_test_data.py
```

---

## OPTION 2: Deploy to Railway (Alternative FREE Option)

### Step 1: Install Railway CLI

```bash
npm install -g @railway/cli
```

### Step 2: Login and Initialize

```bash
railway login
railway init
```

### Step 3: Add PostgreSQL

```bash
railway add --database postgresql
```

### Step 4: Deploy

```bash
railway up
```

### Step 5: Set Environment Variables

```bash
railway variables set DJANGO_SETTINGS_MODULE=config.settings.production
railway variables set DEBUG=False
```

### Step 6: Get Your URL

```bash
railway domain
```

Your app will be live at the provided URL!

---

## OPTION 3: Deploy to PythonAnywhere (FREE Tier Available)

### Step 1: Sign up at [pythonanywhere.com](https://www.pythonanywhere.com)

### Step 2: Open Bash Console

```bash
git clone https://github.com/YOUR_USERNAME/mmu-bicycle-rental.git
cd mmu-bicycle-rental
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Step 3: Configure Web App

1. Go to "Web" tab
2. Click "Add a new web app"
3. Select "Manual configuration"
4. Choose Python 3.10
5. Set:
   - **Source code:** `/home/yourusername/mmu-bicycle-rental`
   - **Working directory:** `/home/yourusername/mmu-bicycle-rental`
   - **Virtualenv:** `/home/yourusername/mmu-bicycle-rental/venv`
   - **WSGI file:** Edit to point to `config.wsgi`

### Step 4: Configure Static Files

In the "Web" tab, add:
- **URL:** `/static/`
- **Directory:** `/home/yourusername/mmu-bicycle-rental/staticfiles`

### Step 5: Setup Database

```bash
python manage.py migrate
python manage.py createsuperuser
python manage.py collectstatic
```

### Step 6: Reload Web App

Click the big green "Reload" button!

Your app will be live at: `https://yourusername.pythonanywhere.com`

---

## OPTION 4: Deploy to Heroku

### Step 1: Install Heroku CLI

```bash
# macOS
brew install heroku/brew/heroku

# Ubuntu/Debian
curl https://cli-assets.heroku.com/install.sh | sh
```

### Step 2: Create Heroku App

```bash
heroku login
heroku create mmu-bicycle-rental
```

### Step 3: Add PostgreSQL

```bash
heroku addons:create heroku-postgresql:mini
```

### Step 4: Create Procfile

Create `Procfile` in project root:
```
web: gunicorn config.wsgi --log-file -
release: python manage.py migrate
```

### Step 5: Configure Environment

```bash
heroku config:set DJANGO_SETTINGS_MODULE=config.settings.production
heroku config:set DEBUG=False
heroku config:set SECRET_KEY=$(python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())')
```

### Step 6: Deploy

```bash
git push heroku main
```

### Step 7: Create Superuser

```bash
heroku run python manage.py createsuperuser
```

Your app will be live at: `https://mmu-bicycle-rental.herokuapp.com`

---

## OPTION 5: Deploy to VPS (DigitalOcean/Linode/AWS)

### Prerequisites
- VPS with Ubuntu 22.04
- Domain name (optional)

### Step 1: Initial Server Setup

```bash
# SSH into your server
ssh root@your-server-ip

# Update system
apt update && apt upgrade -y

# Install dependencies
apt install python3-pip python3-venv nginx postgresql postgresql-contrib -y
```

### Step 2: Setup PostgreSQL

```bash
sudo -u postgres psql
CREATE DATABASE mmu_bicycle_rental;
CREATE USER mmu_user WITH PASSWORD 'your_password';
ALTER ROLE mmu_user SET client_encoding TO 'utf8';
ALTER ROLE mmu_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE mmu_user SET timezone TO 'Africa/Nairobi';
GRANT ALL PRIVILEGES ON DATABASE mmu_bicycle_rental TO mmu_user;
\q
```

### Step 3: Setup Application

```bash
# Create app user
adduser mmu
su - mmu

# Clone repository
git clone https://github.com/YOUR_USERNAME/mmu-bicycle-rental.git
cd mmu-bicycle-rental

# Setup virtual environment
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Configure environment
cp .env.example .env
nano .env  # Edit with your settings
```

### Step 4: Setup Gunicorn

```bash
# Create systemd service
sudo nano /etc/systemd/system/mmu-bicycle.service
```

Add:
```ini
[Unit]
Description=MMU Bicycle Rental
After=network.target

[Service]
User=mmu
Group=www-data
WorkingDirectory=/home/mmu/mmu-bicycle-rental
Environment="PATH=/home/mmu/mmu-bicycle-rental/venv/bin"
ExecStart=/home/mmu/mmu-bicycle-rental/venv/bin/gunicorn --workers 3 --bind unix:/home/mmu/mmu-bicycle-rental/mmu-bicycle.sock config.wsgi:application

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl start mmu-bicycle
sudo systemctl enable mmu-bicycle
```

### Step 5: Setup Nginx

```bash
sudo nano /etc/nginx/sites-available/mmu-bicycle
```

Add:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location = /favicon.ico { access_log off; log_not_found off; }
    
    location /static/ {
        root /home/mmu/mmu-bicycle-rental;
    }
    
    location /media/ {
        root /home/mmu/mmu-bicycle-rental;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/home/mmu/mmu-bicycle-rental/mmu-bicycle.sock;
    }
}
```

```bash
sudo ln -s /etc/nginx/sites-available/mmu-bicycle /etc/nginx/sites-enabled
sudo nginx -t
sudo systemctl restart nginx
```

### Step 6: Setup SSL with Let's Encrypt

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

---

## ðŸ“Š Post-Deployment Checklist

### For All Platforms:

- [ ] Create superuser account
- [ ] Login to admin panel
- [ ] Load initial data (stations, bikes)
- [ ] Verify users can register
- [ ] Test bicycle reservation flow
- [ ] Test rental flow
- [ ] Check email notifications (configure SMTP)
- [ ] Test on mobile devices
- [ ] Configure custom domain (optional)
- [ ] Setup monitoring (Sentry, etc.)

### Security Checklist:

- [ ] Change SECRET_KEY to something secure
- [ ] Set DEBUG=False
- [ ] Configure ALLOWED_HOSTS properly
- [ ] Enable HTTPS
- [ ] Set secure cookies
- [ ] Configure CORS if using API
- [ ] Setup database backups
- [ ] Configure rate limiting

---

## ðŸŽ¯ Recommended: Render + Custom Domain

**Best setup for production:**

1. Deploy to Render (free PostgreSQL + hosting)
2. Buy domain from Namecheap/GoDaddy ($10/year)
3. Point domain to Render
4. Enable automatic SSL

**Total cost: ~$10/year for domain (hosting is FREE)**

---

## ðŸ“§ Configure Email in Production

### Using Gmail:

```bash
# Environment variables
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
```

### Using SendGrid (Recommended for production):

```bash
# Environment variables
EMAIL_BACKEND=anymail.backends.sendgrid.EmailBackend
SENDGRID_API_KEY=your-sendgrid-api-key
```

---

## ðŸ” Monitoring & Logs

### View Logs:

**Render:**
```bash
# Go to dashboard â†’ Logs tab
```

**Railway:**
```bash
railway logs
```

**Heroku:**
```bash
heroku logs --tail
```

**VPS:**
```bash
sudo journalctl -u mmu-bicycle -f
```

---

## ðŸš¨ Troubleshooting

### Issue: Static files not loading
```bash
python manage.py collectstatic --noinput
```

### Issue: Database connection error
Check DATABASE_URL environment variable

### Issue: 502 Bad Gateway
Check if Gunicorn is running:
```bash
ps aux | grep gunicorn
```

### Issue: Permission denied
```bash
chmod +x build.sh
```

---

## ðŸ“ž Need Help?

- Check deployment platform documentation
- Review application logs
- Test locally first with `python manage.py runserver`
- Verify all environment variables are set

---

## ðŸŽ‰ Your App is Live!

Share your link:
- Render: `https://mmu-bicycle-rental.onrender.com`
- Railway: `https://mmu-bicycle-rental.up.railway.app`
- Heroku: `https://mmu-bicycle-rental.herokuapp.com`
- Custom: `https://your-domain.com`